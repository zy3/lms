var D=Object.defineProperty;var z=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var P=(o,e,t)=>e in o?D(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,q=(o,e)=>{for(var t in e||(e={}))I.call(e,t)&&P(o,t,e[t]);if(z)for(var t of z(e))j.call(e,t)&&P(o,t,e[t]);return o};import{r as E,f as T,v as F,b as G,o as H,q as O,H as d,R as r,az as h,D as _,p as W,j as s,G as k,aA as J,S as m,P as y,aB as K}from"./index-B4LUeTLg.js";import"./index-BnRV7d3v.js";import{P as Q}from"./index-c2-hsIFG.js";import{t as b,a as v}from"./common-CBPeEccM.js";import{q as X,a as Y,b as Z}from"./book-D9SslOf9.js";function ee(){const o=E([]),e=E(!0),t=[{label:"姓名",prop:"name"},{label:"班级年级",prop:"gradeClass",slot:"gradeClassSlot"},{label:"学（工）号",prop:"studentNum"},{label:"类型",prop:"readerType",slot:"readerTypeSlot"},{label:"状态",prop:"status",slot:"statusSlot"},{label:"操作",width:"120",fixed:"right",slot:"operation"}],C=T({pageSize:10,currentPage:1,pageSizes:[10,20,50],total:0,align:"right",background:!0,size:"default"}),g=T({text:"正在加载第一页...",viewBox:"-10, -10, 50, 50",spinner:`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `});return{loading:e,columns:t,dataList:o,pagination:C,loadingConfig:g}}const ae=k("h5",null,"数据筛选",-1),te={style:{display:"flex","justify-content":"space-between","align-items":"center"}},se=k("h5",null,"数据列表",-1),de=F({name:"ReaderManagement",__name:"index",setup(o){let e=T({gradeClassEnums:[],readerTypeEnums:[],readerStatusEnums:[]});const t=G();function C(){X().then(a=>{if(a.code===200){let n=a.data,u=b(n.gradeClassEnums);e.gradeClassEnums.push(...u);let i=b(n.readerTypeEnums);e.readerTypeEnums.push(...i);let S=b(n.readerStatusEnums);e.readerStatusEnums.push(...S)}else h(a.message,{type:"error"})}).catch(()=>{})}const g=E({}),w=[{label:"姓名",prop:"name"},{label:"年级班级",prop:"gradeClass",valueType:"select",options:e.gradeClassEnums},{label:"类型",prop:"readerType",valueType:"select",options:e.readerTypeEnums},{label:"状态",prop:"status",valueType:"select",options:e.readerStatusEnums},{label:"学（工）号",prop:"studentNum"}],L=a=>{c()},R=()=>{c()},{loading:f,columns:B,dataList:x,pagination:p,loadingConfig:N}=ee();function U(a){p.pageSize=a,c()}function V(a){p.currentPage=a,c(),N.text=`正在加载第${a}页...`}function c(){let a=g.value,n=q({pageNo:p.currentPage,pageSize:p.pageSize},a);Y(n).then(u=>{var i;u.code===200?(x.value=((i=u.data)==null?void 0:i.rows)||[],p.total=u.data.total,f.value=!1):(f.value=!1,h(u.message,{type:"error"}))}).catch(()=>{f.value=!1})}function $(a){t.push({path:`/reader/edit/${a.readerUniqueId}`})}function M(a){K.confirm(`确定${a.status==="N"?"停用":"启用"}本条记录`,"信息",{type:"warning"}).then(()=>{Z({readerUniqueId:a.readerUniqueId,status:a.status==="N"?"S":"N"}).then(n=>{n.code===200?(h("操作成功",{type:"success"}),c()):(f.value=!1,h(n.message,{type:"error"}))})}).catch(()=>{})}return H(()=>{C(),c()}),(a,n)=>{const u=_("el-card"),i=_("el-button"),S=_("pure-table");return W(),O("div",null,[d(u,null,{header:r(()=>[ae]),default:r(()=>[d(s(Q),{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=l=>g.value=l),columns:w,"label-width":"90","label-position":"right",hasUnfold:!1,onSearch:L,onReset:R},null,8,["modelValue"])]),_:1}),d(u,{style:{"margin-top":"16px"}},{default:r(()=>[k("div",te,[se,d(i,{type:"primary",icon:s(J),onClick:n[1]||(n[1]=l=>s(t).push("/reader/add"))},{default:r(()=>[m("新增读者")]),_:1},8,["icon"])]),d(S,{style:{"margin-top":"16px"},border:"",stripe:"","row-key":"readerUniqueId",alignWhole:"left",showOverflowTooltip:"",loading:s(f),"loading-config":s(N),data:s(x),columns:s(B),pagination:s(p),onPageSizeChange:U,onPageCurrentChange:V},{gradeClassSlot:r(({row:l})=>[m(y(s(v)(l.gradeClass,s(e).gradeClassEnums)),1)]),readerTypeSlot:r(({row:l})=>[m(y(s(v)(l.readerType,s(e).readerTypeEnums)),1)]),statusSlot:r(({row:l})=>[m(y(s(v)(l.status,s(e).readerStatusEnums)),1)]),operation:r(({row:l})=>[d(i,{link:"",type:"primary",onClick:A=>$(l)},{default:r(()=>[m(" 编辑 ")]),_:2},1032,["onClick"]),d(i,{link:"",type:"primary",onClick:A=>M(l)},{default:r(()=>[m(y(l.status==="N"?"停用":"启用"),1)]),_:2},1032,["onClick"])]),_:1},8,["loading","loading-config","data","columns","pagination"])]),_:1})])}}});export{de as default};
