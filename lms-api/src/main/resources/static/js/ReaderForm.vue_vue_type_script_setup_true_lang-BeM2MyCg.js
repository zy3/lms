var x=(c,i,o)=>new Promise((f,a)=>{var l=r=>{try{p(o.next(r))}catch(_){a(_)}},y=r=>{try{p(o.throw(r))}catch(_){a(_)}},p=r=>r.done?f(r.value):Promise.resolve(r.value).then(l,y);p((o=o.apply(c,i)).next())});import{u as I,b as w,aC as M,aD as L,l as D,v as O,r as z,f as C,o as H,U as V,R as s,az as h,D as g,p as T,G as v,P,H as n,j as u,q as U,K as N,J as F,S as E}from"./index-B4LUeTLg.js";import{t as S}from"./common-CBPeEccM.js";import{q as G,g as J,h as K}from"./book-D9SslOf9.js";function ee(){const c=I(),i=w(),o=M(c.params)?c.query:c.params;function f(l,y){Object.keys(l).forEach(p=>{L(l[p])||(l[p]=l[p].toString())}),y==="add"?(D().handleTags("push",{path:"/reader/readerAdd",name:"ReaderAdd",params:l,meta:{title:"新增读者",dynamicLevel:1}}),i.push({name:"ReaderAdd"})):y==="params"&&(D().handleTags("push",{path:"/reader/readerEdit/:id",name:"ReaderEdit",params:l,meta:{title:"编辑读者",dynamicLevel:1}}),i.push({name:"ReaderEdit",params:l}))}return{toDetail:f,initToDetail:l=>{o&&f(o,l)},getParameter:o,router:i}}const $={style:{display:"flex","justify-content":"space-between"}},Q=v("span",{style:{"font-size":"11px",color:"#999"}},[v("span",{style:{color:"#f00"}},"*"),E(" 为必填项")],-1),ae=O({name:"ReaderForm",__name:"ReaderForm",props:{pageType:{type:String,default:"edit"},readerUniqueId:{type:String}},setup(c){const i=c,o=w(),f=z();let a=C({name:"",gradeClass:"",readerType:"",studentNum:""});const l=C({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],studentNum:[{required:!0,message:"请输入学（工）号",trigger:"blur"}],readerType:[{required:!0,message:"请选择类型",trigger:"change"}]}),y=()=>{h("取消提交",{type:"warning"}),o.push("/reader/readerManagement")},p=d=>x(this,null,function*(){d&&(yield d.validate((t,b)=>{t&&K(a,i.pageType).then(m=>{m.code===200?(h("提交成功",{type:"success"}),o.push("/reader/readerManagement")):h(m.message,{type:"error"})})}))});let r=C({gradeClassEnums:[],readerTypeEnums:[]});function _(){G().then(d=>{if(d.code===200){let t=d.data,b=S(t.gradeClassEnums);r.gradeClassEnums.push(...b);let m=S(t.readerTypeEnums);r.readerTypeEnums.push(...m)}else h(d.message,{type:"error"})}).catch(()=>{})}function j(){J({readerUniqueId:i.readerUniqueId}).then(d=>{d.code===200?Object.assign(a,d.data):h(d.message,{type:"error"})})}return H(()=>{_(),i.pageType&&i.readerUniqueId&&j()}),(d,t)=>{const b=g("el-input"),m=g("el-form-item"),R=g("el-option"),k=g("el-select"),q=g("el-button"),A=g("el-form"),B=g("el-card");return T(),V(B,null,{header:s(()=>[v("div",$,[v("h4",null,P(c.pageType==="add"?"新增":"编辑")+"读者",1),Q])]),default:s(()=>[v("div",null,[n(A,{ref_key:"readFormRef",ref:f,style:{margin:"0 auto","max-width":"500px"},"label-position":"right","label-width":"100px",model:u(a),rules:l,"status-icon":""},{default:s(()=>[n(m,{label:"姓名:",prop:"name"},{default:s(()=>[n(b,{modelValue:u(a).name,"onUpdate:modelValue":t[0]||(t[0]=e=>u(a).name=e),clearable:""},null,8,["modelValue"])]),_:1}),n(m,{label:"年级班级:",prop:"gradeClass"},{default:s(()=>[n(k,{modelValue:u(a).gradeClass,"onUpdate:modelValue":t[1]||(t[1]=e=>u(a).gradeClass=e),placeholder:"",clearable:""},{default:s(()=>[(T(!0),U(F,null,N(u(r).gradeClassEnums,e=>(T(),V(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(m,{label:"学（工）号:",prop:"studentNum"},{default:s(()=>[n(b,{modelValue:u(a).studentNum,"onUpdate:modelValue":t[2]||(t[2]=e=>u(a).studentNum=e),clearable:""},null,8,["modelValue"])]),_:1}),n(m,{label:"类型:",prop:"readerType"},{default:s(()=>[n(k,{modelValue:u(a).readerType,"onUpdate:modelValue":t[3]||(t[3]=e=>u(a).readerType=e),placeholder:"",clearable:""},{default:s(()=>[(T(!0),U(F,null,N(u(r).readerTypeEnums,e=>(T(),V(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(m,{style:{"margin-top":"40px"}},{default:s(()=>[n(q,{onClick:y},{default:s(()=>[E("取消")]),_:1}),n(q,{type:"primary",onClick:t[4]||(t[4]=e=>p(f.value))},{default:s(()=>[E(" 提交 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1})}}});export{ae as _,ee as u};
